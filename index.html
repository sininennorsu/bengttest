<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/404c2b295b.js" crossorigin="anonymous"></script>
    <title>Bengts multiplikationstest</title>
    <style>
        body,
        html {
            margin: 0;
        }

        html {
            height: 100%;
        }

        body {
            height: 90%;
            max-width: 800px;
            margin: 0 auto;
        }

        h1,
        p {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }

        input,
        select,
        .form>div {
            /* display: block; */
            margin: 0 auto;
            font-family: sans-serif;
            font-size: 16px;
            padding: 5px;
        }

        .txt {
            width: 73%;
        }

        .togglebutton {
            float: right;
            margin-right: 10px;
        }

        select {
            width: 83%;
        }

        .form>div {
            width: 81%;
        }

        .txt,
        .form>div {
            margin-bottom: 10px;
            overflow: auto;
        }

        .clearfix {
            clear: both;
        }

        label {
            float: left;
            width: 10%;
            line-height: 1.5;
        }

        .rate-value,
        .pitch-value {
            float: right;
            width: 5%;
            line-height: 1.5;
        }

        #rate,
        #pitch {
            float: right;
            width: 81%;
        }

        .controls {
            text-align: center;
            margin-top: 10px;
        }

        button {
            padding: 6px;
            border: 1px solid darkgray;
            box-shadow: 1px 2px 2px 0px rgba(89, 87, 87, 0.85);
            border-radius: 10%;
        }

        .active {
            background-color: darkgrey;
            box-shadow: unset;
        }

        .btn-group button {
            /* background-color: #4CAF50; */
            /* Green background */
            border: 1px solid darkgray;
            /* Green border */

            padding: 10px 24px;
            /* Some padding */
            cursor: pointer;
            /* Pointer/hand icon */
            float: left;
            /* Float the buttons side by side */
            margin-top: 10px;
        }

        /* Clear floats (clearfix hack) */
        .btn-group:after {
            content: "";
            clear: both;
            display: table;
        }

        .btn-group button:not(:last-child) {
            border-right: none;
            /* Prevent double borders */
        }

        .settingsinput {
            margin-bottom: 5px;
        }

        /* #division {
            display: none;
        } */

        .sum {
            display: table-cell;
            vertical-align: middle;
        }

        .fraction {
            display: table-cell;
            text-align: center;
        }

        .denominator {
            border-top: 1px solid #000;
            display: block;
        }

        .fraction,
        .numerator,
        .denominator {
            padding: 0px 5px;
        }

        .testcontainer>div {
            font-size: 36px;
            width: 81%;
            margin: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        #answercontainer {
            padding-top: 20px;
            margin: 30px;
        }

        #labelfraga {
            width: 20%;
        }

        table,
        th,
        td {
            border: 1px solid black;
            text-align: center;
        }

        thead {
            background-color: #1c87c9;
            color: #ffffff;
        }

        th {
            text-align: center;
            height: 50px;
        }

        tbody tr:nth-child(odd) {
            background: #ffffff;
        }

        tbody tr:nth-child(even) {
            background: #f4f4f4;
        }

        @media only screen and (min-width: 481px) {
            .test>span {
                font-size: 72px;
                padding: 10px;
            }
            .division>span {
                font-size: 72px;
                padding: 10px;
            }
        }

        @media only screen and (max-width: 480px) {
            .test>span {
                font-size: 36px;
                padding: 10px;
            }
            .division>span {
                font-size: 36px;
                padding: 10px;
            }

            .btn-group button {
                padding: 7px 20px;
            }

            .btn-group button:not(:last-child) {
                border-right: unset !important;
                /* Prevent double borders */
            }
        }
    </style>
</head>

<body>

    <!-- <form> -->
    <div class="form">
        <button id="answerbutton" class="togglebutton" onclick="toggleanswers()"><i class="fas fa-check"></i></button>
        <button id="settingsbutton" class="togglebutton" onclick="togglesettings()"><i class="fas fa-cog"></i></button>
        <h1>Bengts matteträning</h1>

        <div id="settings" hidden>
            <h3>Ljudinställningar</h3>
            <div class="settingsinput">Skriv in något i rutan nedan och klicka på "Megafon"-knappen
                för att få det uppläst. Du kan ändra röst i listan.
            </div>
            <div>
                <button onclick="speak(document.getElementById('exempeltext').value)"><i
                        class="fas fa-bullhorn"></i></button>
                <input type="text" class="txt" id="exempeltext">
            </div>
            <div>
                <label for="rate"><i class="fas fa-running"></i></label>
                <input type="range" min="0.5" max="2" value="1" step="0.1" id="rate">
                <div class="rate-value">1</div>
                <div class="clearfix"></div>
            </div>
            <div>
                <label for="pitch"><i class="fab fa-think-peaks"></i></label>
                <input type="range" min="0" max="2" value="1" step="0.1" id="pitch">
                <div class="pitch-value">1</div>
                <div class="clearfix"></div>
            </div>
            <div>
                <select></select>
            </div>

            <div>
                <h3>Addition</h3>
                <h4>Term 1 (tal 1) min och max</h4>
                <div>
                    <div>
                        <label for="plustal1min">min</label>
                        <input type="number" class="settingsinput" value="1" id="plustal1min">
                    </div>
                    <div>
                        <label for="plustal1max">max</label>
                        <input type="number" class="settingsinput" value="10" id="plustal1max">
                    </div>
                </div>
                <h4>Term 2 (tal 2) min och max</h4>
                <div>
                    <div>
                        <label for="plustal2min">min</label>
                        <input type="number" class="settingsinput" value="1" id="plustal2min">
                    </div>
                    <div>
                        <label for="plustal2max">max</label>
                        <input type="number" class="settingsinput" value="10" id="plustal2max">
                    </div>
                </div>
            </div>

            <div>
                <h3>Subtraktion</h3>
                <h4>Term 1 (tal 1) min och max</h4>
                <div>
                    <div>
                        <label for="minustal1min">min</label>
                        <input type="number" class="settingsinput" value="11" id="minustal1min">
                    </div>
                    <div>
                        <label for="minustal1max">max</label>
                        <input type="number" class="settingsinput" value="20" id="minustal1max">
                    </div>
                </div>
                <h4>Term 2 (tal 2) min och max</h4>
                <div>
                    <div>
                        <label for="minustal2min">min</label>
                        <input type="number" class="settingsinput" value="1" id="minustal2min">
                    </div>
                    <div>
                        <label for="minustal2max">max</label>
                        <input type="number" class="settingsinput" value="10" id="minustal2max">
                    </div>
                </div>
            </div>

            <div>
                <h3>Multiplikaiton</h3>
                <h4>Faktor 1 (tal 1) min och max</h4>
                <div>
                    <div>
                        <label for="multital1min">min</label>
                        <input type="number" class="settingsinput" value="2" id="multital1min">
                    </div>
                    <div>
                        <label for="multital1max">max</label>
                        <input type="number" class="settingsinput" value="9" id="multital1max">
                    </div>
                </div>
                <h4>Faktor 2 (tal 2) min och max</h4>
                <div>
                    <div>
                        <label for="multital2min">min</label>
                        <input type="number" class="settingsinput" value="2" id="multital2min">
                    </div>
                    <div>
                        <label for="multital2max">max</label>
                        <input type="number" class="settingsinput" value="9" id="multital2max">
                    </div>
                </div>
            </div>

            <div>
                <h3>Division</h3>
                <span>Täljaren (tal 1) räknas ut genom Nämnare x Kvot</span>
                <h4>Nämnare (tal 2) min och max</h4>
                <div>
                    <div>
                        <label for="divtal1min">min</label>
                        <input type="number" class="settingsinput" value="2" id="divtal1min">
                    </div>
                    <div>
                        <label for="divtal1max">max</label>
                        <input type="number" class="settingsinput" value="10" id="divtal1max">
                    </div>
                </div>
                <h4>Kvot (svaret) min och max</h4>
                <div>
                    <div>
                        <label for="divtal2min">min</label>
                        <input type="number" class="settingsinput" value="1" id="divtal2min">
                    </div>
                    <div>
                        <label for="divtal2max">max</label>
                        <input type="number" class="settingsinput" value="10" id="divtal2max">
                    </div>
                </div>
            </div>
        </div>
        <div class="matteoptions">

            <label for="sekunder"><i class="fas fa-redo-alt"></i></label>
            <input type="number" value="10" id="sekunder">


            <div class="btn-group">
                <button id="n0" class="active" onclick="chooseNumeracy(0)"><i class="fas fa-plus"></i></button>
                <button id="n1" onclick="chooseNumeracy(1)"><i class="fas fa-minus"></i></button>
                <button id="n2" onclick="chooseNumeracy(2)"><i class="fas fa-times"></i></button>
                <button id="n3" onclick="chooseNumeracy(3)"><i class="fas fa-divide"></i></button>
                <button id="n4" onclick="chooseNumeracy(4)"><i class="fas fa-blender"></i></button>
            </div>

            <div class="btn-group">
                <button id="lt" onclick="setSound(true)"><i class="fas fa-volume-up"></i></button>
                <button id="lf" class="active" onclick="setSound(false)"><i class="fas fa-volume-off"></i></button>
            </div>

            <div class="btn-group">
                <button id="start" onclick="starttest()"><i class="fas fa-play"></i></button>
                <button class="active" id="stopp" onclick="stop()"><i class="fas fa-stop"></i></button>
                <button id="answer" onclick="showAnswer()"><i class="fas fa-equals"></i></button>
            </div>
        </div>
    </div>
    <!-- </form> -->

    <div class="testcontainer">
        <div id="fraga"></div>
        <div class="test" id="test">
            <span class="tal1" id="tal1">1</span><span class="raknesatt" id="raknesatt">+</span><span class="tal2"
                id="tal2">2</span><span class="likamed" id="likamed">=</span><span class="resultat"
                id="resultat">3</span>
        </div>
        <div class="division" id="division" style="display:none;"><span class="fraction"><span
                    class="numerator tal1">n234</span><span class="denominator tal2">43242m</span></span>
            <span class="sum likamed">=</span><span class="sum resultat"></span>
        </div>
    </div>



    <div id="answercontainer" hidden>
        <table id="answertable">
            <tr>
                <th id="labelfraga">Fråga</th>
                <th>Svar</th>
            </tr>


        </table>
    </div>


    <script>
        var synth = window.speechSynthesis;

        var inputForm = document.querySelector('form');
        var inputTxt = document.querySelector('.txt');
        var voiceSelect = document.querySelector('select');

        var pitch = document.querySelector('#pitch');
        var pitchValue = document.querySelector('.pitch-value');
        var rate = document.querySelector('#rate');
        var rateValue = document.querySelector('.rate-value');

        var voices = [];
        var svensktIndex = -1
        var voiceselected = false
        var selectedVoice
        var selectedVoiceIndex
        var numeracy = 0 //default plus
        var currentnumeracy = 0
        var numeracyarray = ['+', '-', '*', '/']
        var numeracyshowarray = ['+', '-', 'x', '/']

        var sound = false
        var startInterval
        var runningtest = -1 // -1 ej satt, 0 stoppad, 1 runningtest
        var fraga = 0
        var lang = "sv"

        var hidesettings = null
        var hideanswers = null


        function getRandomIntInclusive(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1) + min); //The maximum is inclusive and the minimum is inclusive
        }

        function populateNumbers() {
            populateraknesatt = numeracy === 4 ? getRandomIntInclusive(0, 3) : numeracy
            currentnumeracy = populateraknesatt
            switch (populateraknesatt) {
                case 0:
                    document.getElementById('test').style.display = "";
                    document.getElementById('division').style.display = "none";
                    tal1 = getRandomIntInclusive(document.getElementById('plustal1min').value, document.getElementById('plustal1max').value)
                    tal2 = getRandomIntInclusive(document.getElementById('plustal2min').value, document.getElementById('plustal2max').value)
                    // raknesattuttal = 'plus'
                    break;
                case 1:
                    document.getElementById('test').style.display = "";
                    document.getElementById('division').style.display = "none";
                    tal1 = getRandomIntInclusive(document.getElementById('minustal1min').value, document.getElementById('minustal1max').value)
                    tal2 = getRandomIntInclusive(document.getElementById('minustal2min').value, document.getElementById('minustal2max').value)
                    // tal1 = getRandomIntInclusive(21, 100)
                    // tal2 = getRandomIntInclusive(1, 20)
                    // raknesattuttal = 'minus'
                    break;
                case 2:
                    document.getElementById('test').style.display = "";
                    document.getElementById('division').style.display = "none";
                    tal1 = getRandomIntInclusive(document.getElementById('multital1min').value, document.getElementById('multital1max').value)
                    tal2 = getRandomIntInclusive(document.getElementById('multital2min').value, document.getElementById('multital2max').value)

                    // tal1 = getRandomIntInclusive(3, 9)
                    // tal2 = getRandomIntInclusive(3, 9)
                    // raknesattuttal = 'gånger'
                    break;
                case 3:
                    document.getElementById('test').style.display = "none";
                    document.getElementById('division').style.display = "";
                    // divtal = getRandomIntInclusive(3, 9)
                    // tal1 = divtal * getRandomIntInclusive(3, 9)
                    // tal2 = divtal
                    divtal = getRandomIntInclusive(document.getElementById('divtal1min').value, document.getElementById('divtal1max').value)
                    divtal2 = getRandomIntInclusive(document.getElementById('divtal2min').value, document.getElementById('divtal2max').value)
                    tal1 = divtal * divtal2
                    tal2 = divtal
                    // raknesattuttal = 'delatmed'
                    break;
            }

            document.getElementById('raknesatt').innerHTML = numeracyshowarray[populateraknesatt]

            // document.getElementById('resultat').innerHTML = ''
            for (i in document.getElementsByClassName('resultat')) {
                    document.getElementsByClassName('resultat')[i].innerHTML = '';
                }

            for (i in document.getElementsByClassName('tal1')) {
                document.getElementsByClassName('tal1')[i].innerHTML = tal1;
            }
            for (i in document.getElementsByClassName('tal2')) {
                document.getElementsByClassName('tal2')[i].innerHTML = tal2;
            }
            // document.getElementsByClassName('tal1').innerHTML = tal1
            // document.getElementsByClassName('tal2').innerHTML = tal2

            if (sound) {
                fragemening = `${tal1}  ${getWordInLanguage("raknesatt")} ${tal2}`
                speak(fragemening)
            }
        }

        function showAnswer() {
            if (runningtest !== 0) { //om ej stoppad
                // doctal1uttal = document.getElementById('tal1').innerText
                // doctal2uttal = document.getElementById('tal2').innerText
                doctal1uttal = document.getElementsByClassName('tal1')[0].innerText
                doctal2uttal = document.getElementsByClassName('tal2')[0].innerText
                doctal1 = parseInt(doctal1uttal)
                doctal2 = parseInt(doctal2uttal)
                switch (document.getElementById('raknesatt').innerText) {
                    case '+':
                        result = doctal1 + doctal2
                        // raknesattuttal = 'plus'
                        break;
                    case '-':
                        result = doctal1 - doctal2
                        // raknesattuttal = 'minus'
                        break;
                    case 'x':
                        result = doctal1 * doctal2
                        // raknesattuttal = 'gånger'
                        break;
                    case '/':
                        result = doctal1 / doctal2
                        // raknesattuttal = 'delat med'
                        break;
                    default:
                        result = doctal1 + doctal2
                }
                for (i in document.getElementsByClassName('resultat')) {
                    document.getElementsByClassName('resultat')[i].innerHTML = result;
                }
                // document.getElementById('resultat').innerHTML = result
                let svar = `${doctal1} ${document.getElementById('raknesatt').innerText} ${doctal2} = ${result}`
                if (fraga > 0) {
                    addRow(fraga, svar, false)
                }

                if (sound) {
                    resultatmening = `${doctal1uttal}  ${getWordInLanguage("raknesatt")} ${doctal2uttal} ${getWordInLanguage("likamed")} ${result.toString()}`
                    speak(resultatmening)
                }
            }
        }

        function setSound(onoff) {
            sound = onoff;
            let soundid = onoff ? 'lt' : 'lf'
            setActive(soundid, 'ljud')
        }

        function togglesettings() {
            hidesettings = hidesettings === null ? false : !hidesettings;
            document.getElementById('settings').hidden = hidesettings;
            if (hidesettings) {
                document.getElementById('settingsbutton').classList.remove('active');
            } else {
                document.getElementById('settingsbutton').classList.add('active');
            }
        }

        function toggleanswers() {
            hideanswers = hideanswers === null ? false : !hideanswers;
            document.getElementById('answercontainer').hidden = hideanswers;
            if (hideanswers) {
                document.getElementById('answerbutton').classList.remove('active');
            } else {
                document.getElementById('answerbutton').classList.add('active');
            }
        }

        function starttest() {
            if (runningtest !== 1) {
                deleteAllRows()
                runningtest = 1
                fraga = 0
                populateTimeoutQuestionAnswer()
                setActive('start', 'startstop')
            }
        }

        function populateOneTimeoutQuestionAnswer() {

            fraga = fraga + 1
            document.getElementById('fraga').style.display ='';
            document.getElementById('fraga').innerHTML = `Fråga ${fraga}:`
            visasvarefter = (document.getElementById('sekunder').value - 4) * 1000
            populateNumbers()
            setTimeout(showAnswer, visasvarefter)

        }

        function populateTimeoutQuestionAnswer() {
            populateOneTimeoutQuestionAnswer()
            intervallmillisekunder = document.getElementById('sekunder').value * 1000
            startInterval = setInterval(populateOneTimeoutQuestionAnswer, intervallmillisekunder)
        }

        function stop() {
            runningtest = 0
            clearInterval(startInterval)
            startInterval = null
            setActive('stopp', 'startstop')
        }

        function chooseNumeracy(choosennumeracy) {
            document.getElementById('fraga').style.display ='none';
            runningtest = -1
            fraga = 0
            numeracy = choosennumeracy
            populateNumbers()
            let numeracyid = 'n' + choosennumeracy
            setActive(numeracyid, 'raknesatt')
        }

        function populateVoiceList() {
            voices = synth.getVoices().sort(function (a, b) {
                const aname = a.name.toUpperCase(), bname = b.name.toUpperCase();
                if (aname < bname) return -1; else if (aname == bname) return 0; else return +1;
            });
            voiceSelect.innerHTML = '';
            for (i = 0; i < voices.length; i++) {
                var option = document.createElement('option');
                option.textContent = voices[i].name + ' (' + voices[i].lang + ')';
                if (voices[i].lang === "sv-SE") {
                    svensktIndex = i

                }

                option.setAttribute('data-lang', voices[i].lang); option.setAttribute('data-name', voices[i].name);
                voiceSelect.appendChild(option);
            }
            if (voices.length > 0) {
                if (selectedVoiceIndex) {
                    voiceSelect.selectedIndex = selectedVoiceIndex
                } else {
                    var selectedIndex = !voiceselected ? svensktIndex > 0 ? svensktIndex : voiceSelect.selectedIndex < 0 ? 0 : voiceSelect.selectedIndex : voiceSelect.selectedIndex;
                    selectedVoice = voices[selectedIndex]
                    voiceSelect.selectedIndex = selectedIndex;
                }
            }

        }

        populateVoiceList();

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoiceList;
        }

        function speak(text) {
            if (synth.speaking) {
                console.error('speechSynthesis.speaking'); return;
            }
            if (text === '') {
                text = document.getElementById('exempeltext').value
            }
            if (text !== '') {
                var utterThis = new SpeechSynthesisUtterance(text);
                utterThis.onend = function (event) {
                    console.log('SpeechSynthesisUtterance.onend');
                }
                utterThis.onerror = function (event) {
                    console.error('SpeechSynthesisUtterance.onerror');
                }
                // var selectedOption = voiceSelect.selectedOptions[0].getAttribute('data-name'); for (i = 0; i < voices.length; i++) {
                //     if (voices[i].name === selectedOption) { utterThis.voice = voices[i]; break; }
                // }
                utterThis.voice = selectedVoice
                utterThis.pitch = pitch.value;
                utterThis.rate = rate.value;
                synth.speak(utterThis);
            }
        }

        function setActive(activebutton, typ) {
            // n0-n4 räknesätt, lt-lf (ljud true, ljud false), start-stopp
            switch (typ) {
                case "raknesatt":
                    document.getElementById('n0').classList.remove('active');
                    document.getElementById('n1').classList.remove('active');
                    document.getElementById('n2').classList.remove('active');
                    document.getElementById('n3').classList.remove('active');
                    document.getElementById('n4').classList.remove('active');
                    document.getElementById(activebutton).classList.add('active');
                    break;
                case "ljud":
                    document.getElementById('lt').classList.remove('active');
                    document.getElementById('lf').classList.remove('active');
                    document.getElementById(activebutton).classList.add('active');
                    break;
                case "startstop":
                    document.getElementById('start').classList.remove('active');
                    document.getElementById('stopp').classList.remove('active');
                    document.getElementById(activebutton).classList.add('active');
                    break;
            }

        }

        function getWordInLanguage(typeofword) {
            //typeofword = raknesatt, likamed
            sprak = {
                "sv": {
                    "raknesatt": {
                        0: "plus",
                        1: "minus",
                        2: "gånger",
                        3: "delat med"
                    },
                    "likamed": "är"
                },
                "de": {
                    "raknesatt": {
                        0: "plus",
                        1: "minus",
                        2: "mal",
                        3: "geteilt durch"
                    },
                    "likamed": "entspricht"
                },
                "en": {
                    "raknesatt": {
                        0: "plus",
                        1: "minus",
                        2: "times",
                        3: "devided with"
                    },
                    "likamed": "equals"
                },
                "es": {
                    "raknesatt": {
                        0: "más",
                        1: "menos",
                        2: "por",
                        3: "divididos"
                    },
                    "likamed": "es igual a"
                },
                "fi": {
                    "raknesatt": {
                        0: "plus",
                        1: "miinus",
                        2: "kertaa",
                        3: "jaettuna"
                    },
                    "likamed": "vastaa"
                },
                "fr": {
                    "raknesatt": {
                        0: "plus",
                        1: "moins",
                        2: "fois",
                        3: "divisés par"
                    },
                    "likamed": "égale"
                },
                "it": {
                    "raknesatt": {
                        0: "più",
                        1: "moins",
                        2: "per",
                        3: "deviato con"
                    },
                    "likamed": "è uguale a"
                },
                "nl": {
                    "raknesatt": {
                        0: "plus",
                        1: "min",
                        2: "keer",
                        3: "gedeeld door"
                    },
                    "likamed": "is gelijk aan"
                },
                "pl": {
                    "raknesatt": {
                        0: "plus",
                        1: "minus",
                        2: "razy",
                        3: "podzielony przez"
                    },
                    "likamed": "równa się"
                }

            }
            returnlang = sprak[lang] ? lang : "en"
            return typeofword === "raknesatt" ? sprak[returnlang][typeofword][currentnumeracy] : sprak[returnlang][typeofword]
        }

        // inputForm.onsubmit = function (event) {
        //     event.preventDefault();
        //     speak();
        //     inputTxt.blur();
        // }

        pitch.onchange = function () {
            pitchValue.textContent = pitch.value;
        }

        rate.onchange = function () { rateValue.textContent = rate.value; }

        voiceSelect.onchange = function () {
            voiceselected = true;
            selectedVoice = voices[voiceSelect.selectedIndex]
            selectedVoiceIndex = voiceSelect.selectedIndex
            lang = voiceSelect[voiceSelect.selectedIndex].getAttribute('data-lang').substring(0, 2)
        }

        function addRow(fraga, svar, top = false) {
            // (B1) GET TABLE
            var table = document.getElementById("answertable");

            // (B2) INSERT ROW
            if (top) { var row = table.insertRow(0); }
            else { var row = table.insertRow(); }

            // (B3) INSERT CELLS
            var cell = row.insertCell();
            cell.innerHTML = fraga;
            cell = row.insertCell();
            cell.innerHTML = svar;
        }

        function deleteAllRows() {
            var table = document.getElementById("answertable");
            let rows = table.rows
            for (let row of table.rows) {
                if (row.rowIndex > 0) {
                    table.deleteRow(row.rowIndex)
                }
            }
        }

    </script>
</body>

</html>